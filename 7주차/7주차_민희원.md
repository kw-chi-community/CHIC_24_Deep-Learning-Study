# 9장 객체 탐지 (p.505~p.600)

9장 내용을 읽고 정리한 내용입니다.

## 객체 탐지 (Object Detection)

이미지나 영상에서 특정 객체를 탐지하고 영역을 인식하는 컴퓨터비전 기술. 크게 물체의 **`분류 작업`** 과 **`지역화 작업`** 으로 나눌 수 있음.

### 분류 (Classification)

- 이미지에서 물체가 어떤 종류인지 분류하는 작업
- 각각의 클래스에 대한 확률값 분석

### 지역화 (Localization)

- 이미지에서 물체의 위치를 파악하는 작업
- 이미지에서 물체가 위치한 영역을 찾아 해당 영역의 좌푯값을 예측

---

**객체 탐지** = `이미지 분류`와 `위치 탐지`가 동시에 이루어지는 작업

-> 더 복잡한 분석 과정을 요구

객체 영역을 표현하는 방법에는 **`경계 상자 방식`** 과 **`마스크 방식`** 이 있음.

### 경계 상자 (Bounding Box)

- 객체의 영역을 `사각형 형태`로 표현
- 이미지에서 `객체의 위치`와 `크기`를 파악할 수 있음.
- 경계 상자는 `정사각형` 또는 `직사각형`의 구조로 선분이 `수평` 또는 `수직한 구조`를 가짐.

### 마스크 (Mask)

- 객체 영역을 픽셀 단위로 정확하게 **`분할(Segmentation)`** 해 표현하는 방식으로 객체 영역의 정확한 표현을 위해서 사용됨.
- 각 픽셀마다 `클래스 정보`를 갖고 있음.

---

객체 탐지 방법으로는 크게 **`경계 상자 탐지`**, **`의미론적 분할`**, **`객체 분할`** 이 있음.

### 경계 상자 탐지 (Bounding Box Detection)

- 경계 상자를 활용해 객체의 영역을 간단하게 표현하는 방법
- 다른 객체 검출 방법에 비해 **처리 속도가 빠르다는 장점**
- 경계 상자는 객체의 영역을 항상 정사각형 또는 직사각형으로 표현하기 때문에 **객체의 상세한 영역을 파악하기 어렵다는 단점** 존재.

### 의미론적 분할 (Semantic Segmentation, 시맨틱 세그멘테이션)

- 마스크 방식을 사용해 이미지에서 객체와 배경을 픽셀 단위로 분할하는 방식.
- 객체의 영역을 정확히 분할하기 때문에 **객체의 상세한 모양을 확인할 수 있음.**
- 배경과 같이 **광범위한 영역의 객체도 검출할 수 있음.**
- 픽셀 단위로 분류하기 때문에 **계산 비용이 높고 객체 간 경계에서 오분류할 가능성이 높음.**

### 객체 분할 (Instance Segmentation, 인스턴스 세그멘테이션)

- 이미지에서 객체를 픽셀 단위로 분리함.
- 경계 상자와 클래스 레이블을 추출함.
- **`경계 상자 탐지`** 와 **`의미론적 분할`** 의 기능을 모두 갖고 있기 때문에 **더 정확한 객체 인식이 가능.**
- 경계 상자와 마스크 방식을 모두 사용하므로 다른 방법보다는 **높은 계산 비용을 필요**로 하며, **더 많은 학습 데이터를 요구**함.

---

## Faster R-CNN

> Towards Real-Time Object Detection with Region Proposal Networks

2015년 샤오칭 렌이 **Fast R-CNN 모델을 개선**해 제안한 방법으로 `객체 탐지`에서 사용되는 모델임.

Fast R-CNN의 **`객체 영역 추정 단계`** 에서 발생하는 **`병목 현상을 개선`** 해 파스칼 VOC 챌린지와 COCO 챌린지 등에서 우승을 차지.

**영역 제안 네트워크(Region Proposal Network, RPN)** 를 사용해 관심 영역을 추출하는 방식을 사용.

> R-CNN과 Fast R-CNN에서 사용되던 선택적 탐색 알고리즘 방법에 비해 **더 정확한 관심 영역 추출을 가능하게 함.**

- GPU에서 깊은 VGG-16 모델을 사용해 5 FPS의 성능을 달성함.
- PASCAL VOC 2007 데이터세트에서는 mAP(mean Average Precision) 78.8%의 성능을 보임.
- 전통적인 파이프라인 방식의 모델과 달리, **중간 단계에서의 처리나 변환 없이** **`입력과 출력 사이의 관계`** 를 **직접 학습**해 결과를 예측함.
- 이를 통해 모델 구성과 훈련이 **더욱 간단**하고 **효율적**으로 이뤄짐.
- **`모델의 유연성`** 이 뛰어나 **다른 모델과의 조합**을 통해 성능을 높일 수 있음. 다양한 변형 모델에서도 우수한 성능 제공.
- 이러한 이유로 아직도 객체 탐지 분야에서 활발히 사용됨.
- 다른 딥러닝 기반 객체 탐지 모델들과 함께 많은 연구와 실제 응용에서 활용되고 있음.

> R-CNN -> Fast R-CNN -> Faster R-CNN

- **영역 제안 네트워크**를 사용해 관심 영역을 추출하고 추출된 관심 영역 풀링을 통해 **고정된 크기의 특징 맵으로 변환**한 후, 이를 `분류기`와 `회귀기`에 입력해 **객체를 검출**함.
- 영역 제안 네트워크에서 `관심 영역 추출`과 `특징 맵 변환`을 동시에 수행해 **모델의 매개변수를 공유**할 수 있어, **더 정량화된 모델을 구성**할 수 있음.

이러한 개선점으로 Fast R-CNN에 비해 **더 높은 성능**과 **속도**를 제공함.

## R-CNN

> Region Based Convolutional Neural Networks

2013년 로스 기르쉬크가 제안한 딥러닝 모델로, **`영역 제안(Region Proposal)`**, `특징 추출(합성곱 모델)`, `서포트 벡터 머신`을 활용해 겍체 탐지를 수행함.

영역 제안과 합성곱 모델을 결합하는 방식이므로 R-CNN(Regions Based CNN)이라고 부름.

- R-CNN의 영역 제안은 객체 탐지를 위해 사용되는 영역 추출 알고리즘 중 하나인 **선택적 탐색(Selective Search) 알고리즘**을 사용함.
- 선택적 탐색 알고리즘은 **규칙 기반 알고리즘**으로 입력 이미지에서 **객체가 있을 만한 후보 영역을 생성함.**
- 후보 영역을 생성하기 위해 입력 이미지에 대한 인접한 픽셀과 비슷한 색상, 질감, 밝기, 크기 등 **유사한 특징을 갖는 영역을 군집화** 함.
- 군집화된 영역에도 같은 과정을 반복해 군집을 확장해 감. 이를 통해 얻은 군집으로 객체가 존재할 수 있는 영역을 추출함.
- 선택적 탐색 알고리즘을 통해 2,000여 개의 영역이 생성되고, 영역마다 **알렉스넷**을 적용해 4,096 크기의 특징 벡터를 **서포트 벡터 머신 분류기에 입력해 객체 분류를 진행함.**
- 서포트 벡터 머신 분류기를 통과하면 2,000여 개의 영역은 클래스와 확률값을 갖게 됨. 가장 우수한 영역을 선택하기 위해 **비최댓값 억제(Non-Maximum Suppression, NMS)** 를 수행함.
- 비최댓값 억제를 통해 추출된 영역은 대략적인 영역만 표현함. 이는 정확한 위치를 나타내지 않으므로 **박스 회귀(Box Regression)** 로 후보 영역이 **실제 영역과 일치하게 학습**해 영역의 위치와 크기를 조정함.

기존의 객체 탐지 알고리즘은 이미지를 영역별로 나눠 각 영역에 대해 객체 여부를 판단했다면, R-CNN은 이미지 내 객체가 위치할 만한 후보 영역을 생성해 객체를 탐지함.

R-CNN에서 사용된 `객체 영역 검출`, `위치 조정`, `분류` 등의 원리는 객체 감지 분야에서 기술적으로 중요한 역할을 함.

## Fast R-CNN

R-CNN을 제안한 로스 기르쉬크가 2015년에 **기존의 R-CNN을 개선**해 제안한 모델임.

**R-CNN 영역 제안 방식**

> 2,000여 개의 후보 영역을 생성하고 합성곱 신경망 모델의 입력으로 전달하는 것

**R-CNN**

- 합성곱 모델에 전달되는 후보 영역은 크기가 매우 다양하고 **모든 후보 영역**을 합성곱 모델에 **전달**하므로 **연산량**과 **메모리 사용량이 많음.**
- `영역 제안 단계`, `합성곱 신경망`, `서포트 벡터 머신`을 사용하므로 **모델 학습 단계가 분리**되어 있어 **종단 간 학습(End-to-End Learnin)** 이 불가능하고 **성능 향상에 제약**이 있었음.

Fast R-CNN은 이러한 단점을 개선하여 더욱 빠르고 정확한 물체 인식 가능하게 함.

**Fast R-CNN**

- 입력 이미지를 사전 학습된 합성곱 신경망에 전달해 특징 맵 추출하고, 이 특징 맵에 영역 제안 방법으로 **관심 영역(Region Of Interest, ROI)**을 찾음.
- 이후 **관심 영역 풀링(ROI Pooling)** 기법을 적용해 **고정된 크기의 특징 맵을 얻음.** 이 특징 맵을 **완전 연결 계층**에 전달해 물체의 `클래스`와 `위치`를 예측.
- Fast R-CNN에서 사용하는 **`관심 영역 풀링`** 은 관심 영역을 잘라내 **고정된 크기의 특징 맵으로 변환**하는 작업임. 후보 영역들은 `다양한 크기`와 `비율`을 가짐. 이러한 후보 영역은 합성곱 모델의 입력값으로 전달하기 위해 고정된 크기의 특징 맵으로 변환함.
- 관심 영역을 특징 맵 크기에 맞게 나누고 분할 영역 중 가장 큰 값을 추출하는 **최댓값 풀링**을 적용해 **고정된 특징 맵으로 변환**함. 이러한 과정을 모든 관심 영역에 적용하면 고정된 크기의 특징 맵으로 변환할 수 있음.
- 고정된 크기의 특징 맵들은 다시 두 개로 나눠, 하나는 `소프트맥스`를 통해 클래스를 분류하고 다른 하나는 `박스 회귀`를 통해 경계 상자를 검출함.

이러한 방법을 통해 `특징 추출`, `관심 영역 풀링`, `객체 분류`, `박스 회귀`를 **종단 간 학습** 시키는 모델을 제시하여, **학습 단계를 간소화**하고 **모델 성능을 향상**시킴.
