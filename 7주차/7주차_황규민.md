# 객체 탐지

크게 물체의 분류 작업과 지역화 작업으로 나뉨

분류(classification): 물체가 어떤 종류인지, 클래스에 대한 확률값 분석

지역화(localization): 물체의 위치를 파악하는 작업을 의미, 물체가 위차한 영역의 좌표값을 예측

영역을 표현하는 2가지 방법

- Bounding Box: 객체의 영역을 사각형 형태로 표현, 위치와 크기를 파악
- Mask: 겍체의 영역을 픽셀 단위로 정확하게 분할해 표현, 각 픽셀마다 클래스 정보를 갖고 있음

객체 탐지 방법의 3가지 방법

- Bounding Box Detection: 경계 상자를 활용해 빠른 속도로 간단하게 표현 가능하지만, 사각형의 한계로 객체의 상세한 영역을 파악하기는 힘듬
- Semantic Segmentation: Mask 방식을 사용해 픽셀단위로 분할하여 섬세한 객체 검출이 가능하지만, 계산 비용이 높고 객체 간 경계에서 오분류할 가능성이 있음
- Instance Segmentation: 객체를 픽셀 단위로 분리하고, 경계 상자와 클래스 레이블을 추출. 두 방식을 모두 사용하므로 더 높은 계산 비용과 학습 데이터를 요구함

# Faster R-CNN(Towards Real-Time Object Detection with Region Proposal Networks)

전통적인 파이프라인 방식의 모델과 달리, 중간 단계에서의 처리나 변환없이 입력과 출력 사이의 관계를 직접 학습해 결과를 예측함 > 모델 구성과 훈련이 더욱 간단해지고 효율적으로 이뤄짐.

또 모델의 유연성이 뛰어나 다른 모델과의 조합을 통해 성능을 높일 수 있고 다양한 변형 모델에서도 우수한 성능을 제공

## R-CNN(Region Based Convolutional Neural Networks)

딥러닝 모델, 영역 제안(Region Proposal), 특징 추출, 서포트 벡터 머신을 활용해 객체 탐지를 수행

영역 제안: 객체 탐지를 위해 사용되는 영역 추출 알고리즘 중 하나인 선택적 탐색(Selective Search)알고리즘 사용(규칙 기반의 알고리즘으로 입력 이미지에서 객체가 있을만한 후보 영역을 생성)

후보 영역은 입력 이미지에 대한 인접한 픽셀과 비슷한 색상, 질감, 밝기, 크기 등 유사한 특징을 갖는 영역을 군집화 > 반복 > 이를 통해 군집으로 객체가 존재할 수 있는 영역을 추출

가장 우수한 영역을 선택하기 위해 비최댓값 억제(Non-Maximum Suppression, NMS)수행해 후보 영역이 실제 영역과 일치하게 학습해 영역의 위치와 크기를 조정

기존의 객체 탐지 알고리즘은 이미지를 영역별로 나눠 각 영역에 대해 객체 여부를 판단했다면,

R-CNN은 이미지 내 객체가 위치할 만한 후보 영역을 생성해 객체를 탐지

## Fast R-CNN

R-CNN의 연산량과 메모리 사용량이 많은 점과 모델 학습 단계가 분리돼 잇어 종단간 학습(End-to-End Learning)이 불가능한 성능 향상의 문제점을 개선한 더울 빠르고 정확한 물체 인식이 가능한 모델

입력 이미지를 사전 학습된 합성곱 신경망에 전달해 특징 맵을 추출, 이 특징 맵에 영역 제안 방법으로 관심 영역(Region Of Interest, ROI)를 찾음

이후 관심 영역 풀링( ROI Pooling)으로 고정된 크기의 특징 맵을 추출해 완전 연결 계층에 전달해 물체의 클래스와 위치를 예측

관심영역풀링: 관심 영역에을 잘라내 고저된 크기의 특징맵으로 변환하는 작업, 후보영역들은 다양한 크기와 비율을 갖음

특징 맵을 두 개로 나눠 하나는 클래스를 분류하고 하나는 경계 상자를 검출

## Faster R-CNN

Region Proposal Network, RPN을 사용해 관심 영역을 추출하는 방식, 앞선 방식보다 더 정확한 관심 영역 추출 가능

영역 제안 네트워크를 사용해 관심 영역을 추출하고 추출된 관심 영역을 관심 영역 풀링을 통해 고정된 크기의 특징 맵으로 변환 후, 이를 분류기와 회귀기 에 입력해 객체를 검출한다.

영역 제안 네트워크에서 관심 영역 추출과 특징 맵 변환을 동시에 수행해 모델의 매개변수를 공유해 더 경량화된 모델 구성

### 영역 제안 네트워크

R-CNN처럼 모든 영역에서 특징 벡터를 추출하는 것이 아닌, 갬체 탐지를 위한 특징 추출과 경계 상자 위치 추정을 위한 영역 제안 방식을 합친 구조

입력 이미지에서 객체의 관심 영역을 추출하는 네트워크이고 GPU 사용이 가능해 더 빠른처리가 가능

입력 받은 특징 맵을 일정한 크기의 윈도 영역을 이동해 가면서 중간 층에 전달하고 합성곱 연산을 수행해 생성된 벡터를 물체를 판별하는 박스 분류 계층과 영역의 좌표를 생성하는 박스 회귀 계층에 전달 슬라이딩 원도는 일정한 크기의 그리드로 분할하고 이미지의 크기를 그리드 크기로 나눔

### 앵커 박스

객체의 위치와 크기를 예측하기 위해 사용되는 사각형 영역, 일반적으로 다양한 종류의 객체를 고려해 여러 개의 크기와 종횡비로 정의됨

128, 256, 512 크기로 맞춰저 있고 1:1, 2:1, 1:2 비율을 사용

### 박스 분류

앵커 박스에 객체가 존재하는지 또는 존재하지 않는 점수를 계산, 한개의 슬라이딩 윈도는 9개의 앵커 박스를 가지고 있어 총 18개가 생성됨

### 박스 회귀

앵커 박스로 크기와 위치를 예측했다면 박스 회귀를 통해 경ㄱ예 상자의 크기와 위치를 조정해야함.

고정적인 비율과 그리드를 통해 특징 맵으로 변환했으므로 예측값은 정확하지 않음.

따라서 R-CNN 처럼 박스 회기를 통해 경계 상자를 조정하는 작업이 진행됨.

### 관심 영역 선별

영역 제안 넽워크를 통해 앵커 박스의 객체 여부와 앵커 박스의 위치와 크기를 계산, 앵커 박스는 특징 맵의 슬라이딩 윈도마다 생성되 특징 맵의 크기가 커질수록 애커 박스의 개수 증가, 선별 방법으로 관심영역을 선택해 학습 및 추론속도가 느려지는 것을 방지

# SSD(Single Shot MultiBox Detector) 555

이미지 내의 객체를 감지하기 위해 이미지의 다양한 위치에서 여러 개의 경계 상자를 예측, Multi-box Detection

멀티 박스 탐지: 이미지에서 사전에 정의된 경계 상자를 설정하고 그것을 Positive와 Negative으로 레이블링해 학습

SSD는 R-CNN과 다르게 1-stage로 처리 속도가 빠르다는 장점, 한번의 순전파로 객체 감지를 수행해 처리 속도가 빠름

특징 추출 모델은 이미지넷으로 사전 학습된 분류 모델에 여러 계층을 추가한 구조로 다양한 크기의 특징맵을 추출해 객체의 다양한 크기를 인식할 수 있고 이런 구조로 영역 제안 결과가 필요없어 병목 현상이 사라져 빠른 추론이 가능해짐

## 멀티 스케일 특징 맵

SSD에서 다양한 크기의 객체를 인시갛기 위해 다양한 크기의 특징 맵을 사용하는 구조로 특징 추출 모델의 앞부분에서 추출한 특징 맵은 작은 객체를 인식할 때 사용하고 뒷부분에서 추출한 특징 맵은 큰 객체를 인식 

## 기본 박스(Default Box)

앵커 박스와 유사한 개념, 차이점은 서로 다른 크기의 특징 맵에 적용한다는 것

특징 맵의 크기가 작을 수록 기본 박스를 크게 설정해 큰 객체를 인식할 수 있고 반대로 특징 맵이 작을 수록 기본 박스는 작게 설정

입력 이미지의 크기와 특징 맵의 크기를 고려해 초기 기본 박스의 크기를 설정, 이후 다양한 스케일 값을 적용해 기본 박스의 크기를 조정

## 모델 학습 과정

Faster R-CNN과 동일하게 박스 분류와 박스 회귀에 대한 손실 함수를 계산

SSD는 영역 제안 네트워크가 없기에 배경 영역을 미리 선별할 수 없고 모델의 출력값 중 대부분이 배경 영역을 차지함 

그러므로 모든 출력값에 대해 학습을 수행하면 배경 역역과 객체 영역 간의 클래스 불균형이 발생해 원활한 학습이 진행되지 않음

이를 해결하기 위해 Hard Negative Mining기법 사용, 모델이 학습하기 어려운 샘플을 선택해 추가 학습을 진행하는 기법

SSD에서는 객체의 영역(Positive)과 배경의 영역(Negative)

# FCN(Fully Convolutional Network)

전통적인 합성곱 신경망의 한계를 극복하고자 고안된 모델, 특징 추출후 완전 연결 계층에서 이미지 분류를 수행하는 모델은 이미지 분류와 객체 탐지와 같은 작업에서는 높은 성능을 보엿지만 의미론적 분할과 같은 작업에서는 높은 성능을 기대하기 어려웠음

의미론적 분할: 이미지에서 각 픽셀에 해당하는 클래스를 구분하고 인스턴스및 배경을 분할하는 것 이미지 내의 모든 객체 및 구조물의 경계를 정확하게 실벽하고 각 픽셀을 이러한 객체 또는 구조물에 할당함으로써 수행되는데, 전통적인 합성곱 신경망 모델은 완전 연결 계층을 사용하기 때문에 위치 정보가 손실되 픽셀의 위치 정보를 파악하기 어려웟음.

FCN은 위치 정보를 유지하면서 클래스 단위의 특징 맵을 추출하기 위해 완전 연결 계층을 제거하고 공간 정보를 포함하는 합성곱 계층으로 대체함 > 구조가 간단해져 의미론적 분할 문제 해결에 있어 보다 정교하고 우수한 성능을 보임

## 업샘플링(Upsampling)

계층을 통과할수록 특징 맵의 크기가 줄어 업샘플링을 통해 특징맵의 입력 크기와 동일하게 확장하는 과정을 추가, 이를 통해 FCN 은 이볅 이미지의 공간 정보를 보존하면서 객체를 픽셀 수준으로 정확하게 분할할 수 있음

보간 방법의 2가지 기법

- 이중 선형 보간법(Bilinear Interpolation)

이웃하는 4개의 픽셀 값에 대한 가중치를 계산, 선형 보간법을여러 번 적용해 구할 수 있음 

계산이 간단하고 빠르지만, 높은 정확도를 요구하는 이미지 확대 작업에는 적합하지 않음

- 전치 합성곱(Transposed Convloution)

입력에 패딩을 넢어 입력의 크기보다 큰 출력값을 생성하는 합성곱 연산, 간격과 커널의 크기를 설정해 출력 크기를 조절할 수 있음

학습이 가능해 일반적인 보간법보다 더 나은 성능을 보일 수 있지만 크기가 클수록 연산량이 기하급수적으로 증가해 최근엔 사용하지 않는 경향이 있음 ( 높은 계산 비용)

